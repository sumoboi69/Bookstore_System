{% extends "layout.html" %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold"><i class="fas fa-chart-line me-2 text-primary"></i>System Reports</h2>
    <button class="btn btn-outline-primary" onclick="window.print()">
        <i class="fas fa-print me-2"></i>Print Report
    </button>
</div>

<h5 class="text-secondary border-bottom pb-2 mb-3">Sales Performance</h5>
<div class="row g-4 mb-5">
    
    <div class="col-md-6">
        <div class="card h-100 border-primary border-start border-4 shadow-sm">
            <div class="card-body">
                <h6 class="text-muted text-uppercase small fw-bold">Sales (Previous Month)</h6>
                <div class="d-flex align-items-center mt-2">
                    <h2 class="display-6 fw-bold mb-0 text-dark">${{ "{:,.2f}".format(last_month_sales) }}</h2>
                </div>
                <p class="text-muted small mt-2 mb-0">Last 30 days</p>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card h-100 shadow-sm">
            <div class="card-body">
                <h6 class="text-muted text-uppercase small fw-bold">Sales by Specific Date</h6>
                <form action="/admin/daily_sales_report" method="POST" class="mt-3">
                    <div class="input-group">
                        <input type="date" class="form-control" name="report_date" required>
                        <button class="btn btn-primary" type="submit">Get Report</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    
    <div class="col-lg-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white fw-bold">
                Top 5 Customers (Last 3 Months)
            </div>
            <div class="card-body">
                {% if top_customers %}
                <table class="table table-sm table-striped mt-2">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Customer Name</th>
                            <th class="text-end">Total Spent</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for customer in top_customers %}
                        <tr>
                            <td>{{ customer.rank }}</td>
                            <td>{{ customer.name }}</td>
                            <td class="text-end">${{ "{:.2f}".format(customer.total_spent) }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted text-center py-3">No customer data available</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-lg-6">
        <div class="card shadow-sm h-100">
            <div class="card-header bg-white fw-bold">
                Top Selling Books (Last 3 Months)
            </div>
            <div class="card-body">
                {% if top_books %}
                <table class="table table-sm table-hover">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Book Title</th>
                            <th class="text-end">Copies Sold</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for book in top_books %}
                        <tr>
                            <td><span class="badge {% if loop.index == 1 %}bg-warning text-dark{% else %}bg-secondary{% endif %}">{{ loop.index }}</span></td>
                            <td>{{ book.Title }}</td>
                            <td class="text-end">{{ book.copies_sold }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted text-center py-3">No sales data available</p>
                {% endif %}
            </div>
        </div>
    </div>

    <div class="col-12">
        <div class="card shadow-sm">
            <div class="card-header bg-white fw-bold">
                Replenishment History (Orders per Book)
            </div>
            <div class="card-body">
                <p class="small text-muted">Shows how many times the admin placed orders for a particular book.</p>

                {% if replenishment_history %}
                <table class="table table-bordered">
                    <thead>
                        <tr class="table-light">
                            <th>ISBN</th>
                            <th>Book Title</th>
                            <th>Times Ordered</th>
                            <th>Last Order Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for item in replenishment_history %}
                        <tr>
                            <td>{{ item.ISBN }}</td>
                            <td>{{ item.Title }}</td>
                            <td>{{ item.times_ordered }} times</td>
                            <td>{{ item.last_order_date.strftime('%Y-%m-%d') if item.last_order_date else 'N/A' }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted text-center py-3">No replenishment data available</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}